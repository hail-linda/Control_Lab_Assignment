<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


# 云台

@李昕达

## index

- 一些术语、关键词的介绍
- 几个常用算法的介绍与对比
     - SIFT<sup>[1-2]</sup>
     - SURF<sup>[1-2]</sup>
     - ORB<sup>[1-2]</sup>
- 某种算法的opencv-python实现与展示

[TOC]

## 术语与一些关键词

__特征点__ ：指在图像中突出且具有代表意义的一些点，这些点可以用来表征、识别图像、进行图像配准、进行3D重建等，主要将角点视为有效的特征点。  

角点通常为在灰度化图像中水平、竖直方向上变化均较大的点，通常为两条边缘的交点，更严格的说，角点的局部邻域应该具有两个不同区域的不同方向的边界<sup>[3]</sup>。  

__Harris角点算法__<sup>[4,6]</sup>：简单来讲，就是拿一个小窗在图像中移动，通过考察这个小窗口内图像灰度的平均变换值来确定角点。  

- 如果窗口内区域图像的灰度值恒定，那么所有不同方向的偏移几乎不发生变化；  
- 如果窗口跨越一条边，那么沿着这条边的偏移几乎不发生变化， 但是与边垂直的偏移会发生很大的变化；  
- 如果窗口包含一个孤立的点或者角点，那么所有不同方向的偏移会发生很大的变化。  

当窗口发生[u,v]移动时，那么滑动前与滑动后对应的窗口中的像素点灰度变化描述如下：  
$$
E(u,v)=\sum w(x,y)[I(x_u,y+v)-I(x,y)]^2
$$

>[u,v]是窗口的偏移量  
>(x,y)是窗口内所对应的像素坐标位置，窗口有多大，就有多少个位置  
>w(x,y)是窗口函数,窗口函数内所设置权值可以为平均分布或高斯分布，当窗口中心存在孤立的角点时，该点在高斯分布下的灰度变化贡献远大于平均分布下的贡献  
> 此外，将窗口函数描绘为一个椭圆高斯分布还可以指明角点的指向。  

## 几个常用算法的介绍与对比

### SIFT：尺度不变性特征转换<sup>[5,8-9]</sup>

SIFT是一种通过在空间中寻找极值点来侦测与描述图像中的局部性特征的算法。  

SIFT算子是把图像中检测到的特征点用一个128维的特征向量进行描述，因此一幅图像经过SIFT算法后表示为一个128维的特征向量集，该特征向量集具有对图像缩放，平移，旋转不变的特征，对于光照、仿射和投影变换也有一定的不变性，是一种非常优秀的局部特征描述算法<sup>[7]</sup>。 

__SIFT算法大致的实现流程为：__

 1. 尺度空间极点检测
 2. 关键点精确定位
 3. 关键点的方向确定
 4. 特征向量的生成

#### 尺度空间极点检测：

真实世界中的物体只有在一定的尺度上才有意义，我们所要寻找的特征点就是在连续尺度空间下位置不改变的点。

构建尺度空间的目的就是找到在尺度变化中具有不变性的位置，可以使用连续的尺度变化，即在尺度空间中所有可能的尺度变化中找到稳定的特征点，通过这种方式找到的极点可以保证在图像缩放和旋转变化中具有不变性。

> 构建尺度空间的目的就是构建一个尺度金字塔，在金字塔的每一层都有该特征点不同尺度的图像，通过这些图像对应的特征点来进行匹配，进而得到特征的匹配

尺度空间的内核是高斯函数.假设 $I(x,y)$是原始图像,$G(x,y,\sigma)$是尺度空间可变的高斯函数,则
一个函数的尺度空间可以定义为

$$
L(x,y,\sigma) = G(x,y,\sigma) * I(x,y)\tag{1}
$$

其中$*$表示的是卷积运算，$\sigma$表示尺度空间的大小，$\sigma$越大则表示越模糊，表示图像的概貌，$\sigma$越小则表示越清晰，表示图像的细节。高斯函数$G(x,y,\sigma)$定义为

$$
G(x,y,\sigma) = \frac{1}{2\pi\sigma^2}e^{-(x^2+y^2)/2\sigma^2}\tag{2}
$$

经过一系列的尺度空间变化和二倍下采样,最终得到高斯金字塔.

为了在尺度空间中找到稳定不变的极值点，在SIFT算法中使用了高斯差分(DOG)函数  $ D(x,y,\sigma)$ ，定义为

$$
D(x,y,\sigma) = [G(x,y,k\sigma) - G(x,y,\sigma)] * I(x,y)\\=L(x,y,k\sigma) - L(x,y,\sigma)\tag{3}
$$

选择高斯差分函数的原因如下:

1. 计算简单 $L$函数需要一定计算,$D$函数只需要减法
2. LoG的运算效率不高


#### 关键点(特征点)精确定位:
计算机中存储的图像数据是离散的，而我们之前找到的极值点也就是离散空间中的极值点，但是离散空间中的极值点并不是真实的连续空间中的极值点。所以需要对DoG空间进行拟合处理，以找到极值点的精确位置和尺度。另外，我们还需要去除那些在边缘位置的极值点，以提高关键点的稳定性。


在Lowe的论文<sup>[5]</sup>中，使用的是泰勒展开式作为拟合函数。我们得到的极值点是一个三维向量，包括它所在的尺度$\sigma$以及所在尺度图像中的位置坐标，即$X = (x,y,\sigma)$.因此需要三维的泰勒展开式进行展开，设$X_0 = (x_0,y_0,\sigma_0)$，则其展开式的矢量形式为：

$$
f(X) = f(X_0）+\frac{\partial f^T}{\partial X}(X- X_0)+\frac{1}{2}(X-X_0)^T\frac{\partial^2 f}{\partial X^2}(X-X_0)\tag{4}
$$

__去除边缘影响:__

到这一步,我们已经得到了许多的极值点,但是其中有一部分不是我们想要的,当中就有一大部分是边缘区域产生的极值点。因为物体的边缘轮廓在灰度图中，存在着灰度值的突变，这样的点在计算中就被“误以为”是特征值。

由于图像中的物体的边缘位置的点的主曲率一般会比较高，因此我们可以通过主曲率来判断该点是否在物体的边缘位置。某像素点位置处的主曲率可以由二维的Hessian矩阵$H$计算得到

$$
H = \left[\begin{matrix}D_{xx}(x,y)&D_{xy}(x,y)\\D_{xy}(x,y)&D_{yy}(x,y)\end{matrix}\right]
$$

具体后续计算可参见__Harris角点检测算法__.

#### 特征点方向的计算:

为了实现特征点的旋转不变性，因此需要计算特征点的角度。在计算特征点的方向时是根据特征点所在的高斯尺度图像中的局部特征计算出的。该高斯尺度$\sigma$是已知的，并且该尺度是相对于该图像所在的组的基准图像的。所谓的局部特征就是特征点的邻域区域内所有像素的梯度幅角和梯度幅值，这里邻域区域定义为在该图像中以特征点为圆心，以$r$为半径的圆形区域

$$
r = 3*1.5\sigma\tag{5}
$$


像素的梯度幅值/幅角计算公式为:
$$
m(x,y) = \sqrt{(L(x+1,y) - L(x-1,y))^2 + (L(x,y+1)-L(x,y-1))^2}\tag{6}
$$
$$
\theta(x,y) = arctan\left(\frac{L(x,y+1)-L(x,y-1)}{L(x+1,y)-L(x-1,y)}\right)\tag{7}
$$

取幅值最高的方向为主方向,超过峰值能量的百分之80的方向，称为辅方向。

#### 特征向量的生成:

到这里,我们已经得到了一组SIFT特征点,包含了位置,尺度,方向等信息.

接下来,我们用一组向量将这些特性包括关键点周围的特征描绘出来.

先将坐标轴旋转为关键点的方向，以确保旋转不变性。以关键点为中心取8×8的窗口。







[3] https://blog.csdn.net/mmjwung/article/details/6748895  
[4] https://blog.csdn.net/a429051366/article/details/51009438  
[5]Lowe D G. Distinctive image features from scale-invariant keypoints[J]. International journal of computer vision, 2004, 60(2): 91-110.  
[6] https://blog.csdn.net/lwzkiller/article/details/54633670  
[7] https://blog.csdn.net/lhanchao/article/details/52345845
[8] https://blog.csdn.net/weixin_38404120/article/details/73740612
[9] https://www.cnblogs.com/YiXiaoZhou/p/5893835.html
[4][4]